<div>
    <h1>Your Bookings</h1>
    <div>
        {% for booking in user_bookings %}
            <div class="booking-item" data-booking-id="{{ booking.id }}">
                <h2>{{ booking.time_slot.bookable_item.name }}</h2>
                <p>Time: {{ booking.time_slot.time_start }}</p>
                <p>Length: {{ booking.time_slot.time_length }}</p>
                {% if booking.notes %}<p>Notes: {{ booking.notes }}</p>{% endif %}
                <button data-booking-id="{{ booking.id }}"
                        onclick="deleteBooking({{ booking.id }})"
                        style="background-color: #dc3545;
                               color: white;
                               border: none;
                               padding: 8px 16px;
                               border-radius: 4px;
                               cursor: pointer">Cancel Booking</button>
            </div>
        {% endfor %}
    </div>
</div>
<script>


function deleteBooking(bookingId) {

    if (confirm('Are you sure you want to cancel this booking?')) {
        // Disable button during request
        this.disabled = true;
        this.textContent = 'Cancelling...';
        
        fetch('/user-bookings/', {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                booking_id: bookingId
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                //TODO: add success taost message
            
                // update the user bookings section & the available time slots section
                document.dispatchEvent(new CustomEvent('booking-cancelled'));
            } else {
                // Show error message
                alert('Error: ' + data.error);
                
                // Re-enable button
                this.disabled = false;
                this.textContent = 'Cancel Booking';
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('An error occurred while cancelling the booking.');
            
            // Re-enable button
            this.disabled = false;
            this.textContent = 'Cancel Booking';
        });
    }

}


</script>
